generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  createdAt DateTime @default(now())

  positions    Position[]
  applications Application[]
  messages     Message[]
}

model Position {
  id        Int      @id @default(autoincrement())
  title     String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  company   Company @relation(fields: [companyId], references: [id])
  companyId Int

  applications Application[]
}

model CandidateCV {
  id        Int      @id @default(autoincrement())
  fileUrl   String
  source    String // mobile, web, qr, vs
  createdAt DateTime @default(now())

  applications Application[]
}

model User {
  id        Int      @id @default(autoincrement())
  fullName  String?
  email     String   @unique
  password  String
  createdAt DateTime @default(now())

  applications Application[]
  messages     Message[]
}

model Application {
  id        Int      @id @default(autoincrement())
  note      String?
  status    String   @default("new") // new, review, invite, red
  createdAt DateTime @default(now())

  company   Company @relation(fields: [companyId], references: [id])
  companyId Int

  position   Position? @relation(fields: [positionId], references: [id])
  positionId Int?

  cv   CandidateCV @relation(fields: [cvId], references: [id])
  cvId Int

  user   User @relation(fields: [userId], references: [id])
  userId Int

  analysis AnalysisResult?
  Message  Message[]

  @@index([userId])
  @@index([companyId])
  @@index([positionId])
  @@index([createdAt])
}

model AnalysisResult {
  id Int @id @default(autoincrement())

  totalScore      Int
  educationScore  Int
  experienceScore Int
  skillScore      Int

  strengths   String
  suggestions String
  careerNote  String

  createdAt DateTime @default(now())

  application   Application @relation(fields: [applicationId], references: [id])
  applicationId Int         @unique
}

model Message {
  id Int @id @default(autoincrement())

  user   User @relation(fields: [userId], references: [id])
  userId Int

  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  application   Application? @relation(fields: [applicationId], references: [id])
  applicationId Int?

  title     String
  body      String
  type      String   @default("info") // info, system, status
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([userId, isRead])
  @@index([companyId])
  @@index([applicationId])
  @@index([createdAt])
}
